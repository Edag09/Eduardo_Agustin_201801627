import { __decorate, __metadata } from "tslib";
import { Component, ViewChild, ElementRef, EventEmitter, Output, Input, ChangeDetectionStrategy } from '@angular/core';
import { filter, take } from 'rxjs/operators';
import { MonacoEditorLoaderService } from '../../services/monaco-editor-loader.service';
var MonacoDiffEditorComponent = /** @class */ (function () {
    function MonacoDiffEditorComponent(monacoLoader) {
        this.monacoLoader = monacoLoader;
        this.init = new EventEmitter();
    }
    MonacoDiffEditorComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.container = this.editorContent.nativeElement;
        this.monacoLoader.isMonacoLoaded$.pipe(filter(function (isLoaded) { return isLoaded; }), take(1)).subscribe(function () {
            _this.initMonaco();
        });
    };
    MonacoDiffEditorComponent.prototype.ngOnChanges = function (changes) {
        if (this.editor && ((changes.code && !changes.code.firstChange) || (changes.modified && !changes.modified.firstChange))) {
            var modified = monaco.editor.createModel(this.modified);
            var original = monaco.editor.createModel(this.original);
            this.editor.setModel({
                original: original,
                modified: modified
            });
        }
        if (this.editor &&
            changes.options &&
            !changes.options.firstChange) {
            if (changes.options.previousValue.theme !== changes.options.currentValue.theme) {
                monaco.editor.setTheme(changes.options.currentValue.theme);
            }
            this.editor.updateOptions(changes.options.currentValue);
        }
    };
    MonacoDiffEditorComponent.prototype.initMonaco = function () {
        var opts = {
            readOnly: true,
            automaticLayout: true,
            theme: 'vc'
        };
        if (this.options) {
            opts = Object.assign({}, opts, this.options);
        }
        this.editor = monaco.editor.createDiffEditor(this.container, opts);
        var original = monaco.editor.createModel(this.original);
        var modified = monaco.editor.createModel(this.modified);
        this.editor.setModel({
            original: original,
            modified: modified
        });
        this.editor.layout();
        this.init.emit(this.editor);
    };
    MonacoDiffEditorComponent.prototype.ngOnDestroy = function () {
        if (this.editor) {
            this.editor.dispose();
        }
    };
    MonacoDiffEditorComponent.ctorParameters = function () { return [
        { type: MonacoEditorLoaderService }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], MonacoDiffEditorComponent.prototype, "original", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], MonacoDiffEditorComponent.prototype, "modified", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], MonacoDiffEditorComponent.prototype, "options", void 0);
    __decorate([
        Output(),
        __metadata("design:type", EventEmitter)
    ], MonacoDiffEditorComponent.prototype, "init", void 0);
    __decorate([
        ViewChild('diffEditor', { static: true }),
        __metadata("design:type", ElementRef)
    ], MonacoDiffEditorComponent.prototype, "editorContent", void 0);
    MonacoDiffEditorComponent = __decorate([
        Component({
            selector: 'ngx-monaco-diff-editor',
            template: "<div #container class=\"editor-container\" fxFlex>\n\t\t<div\n\t\t\t#diffEditor\n\t\t\tclass=\"monaco-editor\"\n\t\t></div>\n</div>",
            changeDetection: ChangeDetectionStrategy.OnPush,
            styles: ["\n.monaco-editor {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n\n}\n.editor-container {\n\toverflow: hidden;\n\tposition: relative;\n\tdisplay: table;\n\twidth: 100%;\n  height: 100%;\n  min-width: 0;\n}"]
        }),
        __metadata("design:paramtypes", [MonacoEditorLoaderService])
    ], MonacoDiffEditorComponent);
    return MonacoDiffEditorComponent;
}());
export { MonacoDiffEditorComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uYWNvLWRpZmYtZWRpdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BtYXRlcmlhLXVpL25neC1tb25hY28tZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvbW9uYWNvLWRpZmYtZWRpdG9yL21vbmFjby1kaWZmLWVkaXRvci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDSCxTQUFTLEVBQ1QsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBSVosTUFBTSxFQUNOLEtBQUssRUFDTCx1QkFBdUIsRUFFMUIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU5QyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSw2Q0FBNkMsQ0FBQztBQWdDeEY7SUFXSSxtQ0FBb0IsWUFBdUM7UUFBdkMsaUJBQVksR0FBWixZQUFZLENBQTJCO1FBSmpELFNBQUksR0FBOEMsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQUloQixDQUFDO0lBRWhFLDRDQUFRLEdBQVI7UUFBQSxpQkFRQztRQVBHLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUM7UUFDbEQsSUFBSSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUNsQyxNQUFNLENBQUMsVUFBQSxRQUFRLElBQUksT0FBQSxRQUFRLEVBQVIsQ0FBUSxDQUFDLEVBQzVCLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FDVixDQUFDLFNBQVMsQ0FBQztZQUNSLEtBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUN0QixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCwrQ0FBVyxHQUFYLFVBQVksT0FBc0I7UUFDOUIsSUFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFD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R0QsQ0FBQzt5Q0FZb0MseUJBQXlCO09BWGxELHlCQUF5QixDQXdFckM7SUFBRCxnQ0FBQztDQUFBLEFBeEVELElBd0VDO1NBeEVZLHlCQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgQ29tcG9uZW50LFxuICAgIFZpZXdDaGlsZCxcbiAgICBFbGVtZW50UmVmLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBPbkluaXQsXG4gICAgT25DaGFuZ2VzLFxuICAgIE9uRGVzdHJveSxcbiAgICBPdXRwdXQsXG4gICAgSW5wdXQsXG4gICAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gICAgU2ltcGxlQ2hhbmdlc1xufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGZpbHRlciwgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgTW9uYWNvRWRpdG9yTG9hZGVyU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL21vbmFjby1lZGl0b3ItbG9hZGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgTW9uYWNvRGlmZkVkaXRvckNvbnN0cnVjdGlvbk9wdGlvbnMsIE1vbmFjb1N0YW5kYWxvbmVEaWZmRWRpdG9yIH0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcyc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnbmd4LW1vbmFjby1kaWZmLWVkaXRvcicsXG4gICAgdGVtcGxhdGU6IGA8ZGl2ICNjb250YWluZXIgY2xhc3M9XCJlZGl0b3ItY29udGFpbmVyXCIgZnhGbGV4PlxuXHRcdDxkaXZcblx0XHRcdCNkaWZmRWRpdG9yXG5cdFx0XHRjbGFzcz1cIm1vbmFjby1lZGl0b3JcIlxuXHRcdD48L2Rpdj5cbjwvZGl2PmAsXG4gICAgc3R5bGVzOiBbXG4gICAgICAgIGBcbi5tb25hY28tZWRpdG9yIHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICB0b3A6IDA7XG4gIGJvdHRvbTogMDtcbiAgbGVmdDogMDtcbiAgcmlnaHQ6IDA7XG5cbn1cbi5lZGl0b3ItY29udGFpbmVyIHtcblx0b3ZlcmZsb3c6IGhpZGRlbjtcblx0cG9zaXRpb246IHJlbGF0aXZlO1xuXHRkaXNwbGF5OiB0YWJsZTtcblx0d2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMTAwJTtcbiAgbWluLXdpZHRoOiAwO1xufWBcbiAgICBdLFxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIE1vbmFjb0RpZmZFZGl0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgICBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50O1xuICAgIGVkaXRvcjogTW9uYWNvU3RhbmRhbG9uZURpZmZFZGl0b3I7XG5cbiAgICBASW5wdXQoKSBvcmlnaW5hbDogc3RyaW5nO1xuICAgIEBJbnB1dCgpIG1vZGlmaWVkOiBzdHJpbmc7XG4gICAgQElucHV0KCkgb3B0aW9uczogTW9uYWNvRGlmZkVkaXRvckNvbnN0cnVjdGlvbk9wdGlvbnM7XG4gICAgQE91dHB1dCgpIGluaXQ6IEV2ZW50RW1pdHRlcjwgTW9uYWNvU3RhbmRhbG9uZURpZmZFZGl0b3I+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgQFZpZXdDaGlsZCgnZGlmZkVkaXRvcicsIHtzdGF0aWM6IHRydWV9KSBlZGl0b3JDb250ZW50OiBFbGVtZW50UmVmO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBtb25hY29Mb2FkZXI6IE1vbmFjb0VkaXRvckxvYWRlclNlcnZpY2UpIHsgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gdGhpcy5lZGl0b3JDb250ZW50Lm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgIHRoaXMubW9uYWNvTG9hZGVyLmlzTW9uYWNvTG9hZGVkJC5waXBlKFxuICAgICAgICAgICAgZmlsdGVyKGlzTG9hZGVkID0+IGlzTG9hZGVkKSxcbiAgICAgICAgICAgIHRha2UoMSksXG4gICAgICAgICkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaW5pdE1vbmFjbygpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIGlmICh0aGlzLmVkaXRvciAmJiAoKGNoYW5nZXMuY29kZSAmJiAhY2hhbmdlcy5jb2RlLmZpcnN0Q2hhbmdlKSB8fCAoY2hhbmdlcy5tb2RpZmllZCAmJiAhY2hhbmdlcy5tb2RpZmllZC5maXJzdENoYW5nZSkpKSB7XG4gICAgICAgICAgICBjb25zdCBtb2RpZmllZCA9IG1vbmFjby5lZGl0b3IuY3JlYXRlTW9kZWwodGhpcy5tb2RpZmllZCk7XG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbCA9IG1vbmFjby5lZGl0b3IuY3JlYXRlTW9kZWwodGhpcy5vcmlnaW5hbCk7XG4gICAgICAgICAgICB0aGlzLmVkaXRvci5zZXRNb2RlbCh7XG4gICAgICAgICAgICAgICAgb3JpZ2luYWwsXG4gICAgICAgICAgICAgICAgbW9kaWZpZWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yICYmXG4gICAgICAgICAgICBjaGFuZ2VzLm9wdGlvbnMgJiZcbiAgICAgICAgICAgICFjaGFuZ2VzLm9wdGlvbnMuZmlyc3RDaGFuZ2VcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBpZiAoY2hhbmdlcy5vcHRpb25zLnByZXZpb3VzVmFsdWUudGhlbWUgIT09IGNoYW5nZXMub3B0aW9ucy5jdXJyZW50VmFsdWUudGhlbWUpIHtcbiAgICAgICAgICAgICAgICBtb25hY28uZWRpdG9yLnNldFRoZW1lKGNoYW5nZXMub3B0aW9ucy5jdXJyZW50VmFsdWUudGhlbWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmVkaXRvci51cGRhdGVPcHRpb25zKGNoYW5nZXMub3B0aW9ucy5jdXJyZW50VmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpbml0TW9uYWNvKCkge1xuICAgICAgICBsZXQgb3B0czogTW9uYWNvRGlmZkVkaXRvckNvbnN0cnVjdGlvbk9wdGlvbnMgPSB7XG4gICAgICAgICAgICByZWFkT25seTogdHJ1ZSxcbiAgICAgICAgICAgIGF1dG9tYXRpY0xheW91dDogdHJ1ZSxcbiAgICAgICAgICAgIHRoZW1lOiAndmMnXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMpIHtcbiAgICAgICAgICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRzLCB0aGlzLm9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZWRpdG9yID0gbW9uYWNvLmVkaXRvci5jcmVhdGVEaWZmRWRpdG9yKHRoaXMuY29udGFpbmVyLCBvcHRzKTtcblxuICAgICAgICBjb25zdCBvcmlnaW5hbCA9IG1vbmFjby5lZGl0b3IuY3JlYXRlTW9kZWwodGhpcy5vcmlnaW5hbCk7XG4gICAgICAgIGNvbnN0IG1vZGlmaWVkID0gbW9uYWNvLmVkaXRvci5jcmVhdGVNb2RlbCh0aGlzLm1vZGlmaWVkKTtcblxuICAgICAgICB0aGlzLmVkaXRvci5zZXRNb2RlbCh7XG4gICAgICAgICAgICBvcmlnaW5hbCxcbiAgICAgICAgICAgIG1vZGlmaWVkXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmVkaXRvci5sYXlvdXQoKTtcbiAgICAgICAgdGhpcy5pbml0LmVtaXQodGhpcy5lZGl0b3IpO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy5lZGl0b3IpIHtcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yLmRpc3Bvc2UoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==