import { __decorate, __metadata } from "tslib";
import { Component, ViewChild, ElementRef, EventEmitter, Output, Input, ChangeDetectionStrategy } from '@angular/core';
import { filter, take } from 'rxjs/operators';
import { MonacoEditorLoaderService } from '../../services/monaco-editor-loader.service';
let MonacoDiffEditorComponent = class MonacoDiffEditorComponent {
    constructor(monacoLoader) {
        this.monacoLoader = monacoLoader;
        this.init = new EventEmitter();
    }
    ngOnInit() {
        this.container = this.editorContent.nativeElement;
        this.monacoLoader.isMonacoLoaded$.pipe(filter(isLoaded => isLoaded), take(1)).subscribe(() => {
            this.initMonaco();
        });
    }
    ngOnChanges(changes) {
        if (this.editor && ((changes.code && !changes.code.firstChange) || (changes.modified && !changes.modified.firstChange))) {
            const modified = monaco.editor.createModel(this.modified);
            const original = monaco.editor.createModel(this.original);
            this.editor.setModel({
                original,
                modified
            });
        }
        if (this.editor &&
            changes.options &&
            !changes.options.firstChange) {
            if (changes.options.previousValue.theme !== changes.options.currentValue.theme) {
                monaco.editor.setTheme(changes.options.currentValue.theme);
            }
            this.editor.updateOptions(changes.options.currentValue);
        }
    }
    initMonaco() {
        let opts = {
            readOnly: true,
            automaticLayout: true,
            theme: 'vc'
        };
        if (this.options) {
            opts = Object.assign({}, opts, this.options);
        }
        this.editor = monaco.editor.createDiffEditor(this.container, opts);
        const original = monaco.editor.createModel(this.original);
        const modified = monaco.editor.createModel(this.modified);
        this.editor.setModel({
            original,
            modified
        });
        this.editor.layout();
        this.init.emit(this.editor);
    }
    ngOnDestroy() {
        if (this.editor) {
            this.editor.dispose();
        }
    }
};
MonacoDiffEditorComponent.ctorParameters = () => [
    { type: MonacoEditorLoaderService }
];
__decorate([
    Input(),
    __metadata("design:type", String)
], MonacoDiffEditorComponent.prototype, "original", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], MonacoDiffEditorComponent.prototype, "modified", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], MonacoDiffEditorComponent.prototype, "options", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], MonacoDiffEditorComponent.prototype, "init", void 0);
__decorate([
    ViewChild('diffEditor', { static: true }),
    __metadata("design:type", ElementRef)
], MonacoDiffEditorComponent.prototype, "editorContent", void 0);
MonacoDiffEditorComponent = __decorate([
    Component({
        selector: 'ngx-monaco-diff-editor',
        template: `<div #container class="editor-container" fxFlex>
		<div
			#diffEditor
			class="monaco-editor"
		></div>
</div>`,
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: [`
.monaco-editor {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;

}
.editor-container {
	overflow: hidden;
	position: relative;
	display: table;
	width: 100%;
  height: 100%;
  min-width: 0;
}`]
    }),
    __metadata("design:paramtypes", [MonacoEditorLoaderService])
], MonacoDiffEditorComponent);
export { MonacoDiffEditorComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uYWNvLWRpZmYtZWRpdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BtYXRlcmlhLXVpL25neC1tb25hY28tZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvbW9uYWNvLWRpZmYtZWRpdG9yL21vbmFjby1kaWZmLWVkaXRvci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDSCxTQUFTLEVBQ1QsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBSVosTUFBTSxFQUNOLEtBQUssRUFDTCx1QkFBdUIsRUFFMUIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU5QyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSw2Q0FBNkMsQ0FBQztBQWdDeEYsSUFBYSx5QkFBeUIsR0FBdEMsTUFBYSx5QkFBeUI7SUFXbEMsWUFBb0IsWUFBdUM7UUFBdkMsaUJBQVksR0FBWixZQUFZLENBQTJCO1FBSmpELFNBQUksR0FBOEMsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQUloQixDQUFDO0lBRWhFLFFBQVE7UUFDSixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDO1FBQ2xELElBQUksQ0FBQyxZQUFZLENBQUMsZUFBZSxDQUFDLElBQUksQ0FDbEMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQzVCLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FDVixDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUU7WUFDYixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDdEIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsV0FBVyxDQUFDLE9BQXNCO1FBQzlCLElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxDQUFDLE9B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R0QsQ0FBQztxQ0FZb0MseUJBQXlCO0dBWGxELHlCQUF5QixDQXdFckM7U0F4RVkseUJBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBDb21wb25lbnQsXG4gICAgVmlld0NoaWxkLFxuICAgIEVsZW1lbnRSZWYsXG4gICAgRXZlbnRFbWl0dGVyLFxuICAgIE9uSW5pdCxcbiAgICBPbkNoYW5nZXMsXG4gICAgT25EZXN0cm95LFxuICAgIE91dHB1dCxcbiAgICBJbnB1dCxcbiAgICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgZmlsdGVyLCB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBNb25hY29FZGl0b3JMb2FkZXJTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvbW9uYWNvLWVkaXRvci1sb2FkZXIuc2VydmljZSc7XG5pbXBvcnQgeyBNb25hY29EaWZmRWRpdG9yQ29uc3RydWN0aW9uT3B0aW9ucywgTW9uYWNvU3RhbmRhbG9uZURpZmZFZGl0b3IgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICduZ3gtbW9uYWNvLWRpZmYtZWRpdG9yJyxcbiAgICB0ZW1wbGF0ZTogYDxkaXYgI2NvbnRhaW5lciBjbGFzcz1cImVkaXRvci1jb250YWluZXJcIiBmeEZsZXg+XG5cdFx0PGRpdlxuXHRcdFx0I2RpZmZFZGl0b3Jcblx0XHRcdGNsYXNzPVwibW9uYWNvLWVkaXRvclwiXG5cdFx0PjwvZGl2PlxuPC9kaXY+YCxcbiAgICBzdHlsZXM6IFtcbiAgICAgICAgYFxuLm1vbmFjby1lZGl0b3Ige1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHRvcDogMDtcbiAgYm90dG9tOiAwO1xuICBsZWZ0OiAwO1xuICByaWdodDogMDtcblxufVxuLmVkaXRvci1jb250YWluZXIge1xuXHRvdmVyZmxvdzogaGlkZGVuO1xuXHRwb3NpdGlvbjogcmVsYXRpdmU7XG5cdGRpc3BsYXk6IHRhYmxlO1xuXHR3aWR0aDogMTAwJTtcbiAgaGVpZ2h0OiAxMDAlO1xuICBtaW4td2lkdGg6IDA7XG59YFxuICAgIF0sXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgTW9uYWNvRGlmZkVkaXRvckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuICAgIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQ7XG4gICAgZWRpdG9yOiBNb25hY29TdGFuZGFsb25lRGlmZkVkaXRvcjtcblxuICAgIEBJbnB1dCgpIG9yaWdpbmFsOiBzdHJpbmc7XG4gICAgQElucHV0KCkgbW9kaWZpZWQ6IHN0cmluZztcbiAgICBASW5wdXQoKSBvcHRpb25zOiBNb25hY29EaWZmRWRpdG9yQ29uc3RydWN0aW9uT3B0aW9ucztcbiAgICBAT3V0cHV0KCkgaW5pdDogRXZlbnRFbWl0dGVyPCBNb25hY29TdGFuZGFsb25lRGlmZkVkaXRvcj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAVmlld0NoaWxkKCdkaWZmRWRpdG9yJywge3N0YXRpYzogdHJ1ZX0pIGVkaXRvckNvbnRlbnQ6IEVsZW1lbnRSZWY7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIG1vbmFjb0xvYWRlcjogTW9uYWNvRWRpdG9yTG9hZGVyU2VydmljZSkgeyB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSB0aGlzLmVkaXRvckNvbnRlbnQubmF0aXZlRWxlbWVudDtcbiAgICAgICAgdGhpcy5tb25hY29Mb2FkZXIuaXNNb25hY29Mb2FkZWQkLnBpcGUoXG4gICAgICAgICAgICBmaWx0ZXIoaXNMb2FkZWQgPT4gaXNMb2FkZWQpLFxuICAgICAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pbml0TW9uYWNvKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgaWYgKHRoaXMuZWRpdG9yICYmICgoY2hhbmdlcy5jb2RlICYmICFjaGFuZ2VzLmNvZGUuZmlyc3RDaGFuZ2UpIHx8IChjaGFuZ2VzLm1vZGlmaWVkICYmICFjaGFuZ2VzLm1vZGlmaWVkLmZpcnN0Q2hhbmdlKSkpIHtcbiAgICAgICAgICAgIGNvbnN0IG1vZGlmaWVkID0gbW9uYWNvLmVkaXRvci5jcmVhdGVNb2RlbCh0aGlzLm1vZGlmaWVkKTtcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsID0gbW9uYWNvLmVkaXRvci5jcmVhdGVNb2RlbCh0aGlzLm9yaWdpbmFsKTtcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yLnNldE1vZGVsKHtcbiAgICAgICAgICAgICAgICBvcmlnaW5hbCxcbiAgICAgICAgICAgICAgICBtb2RpZmllZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgdGhpcy5lZGl0b3IgJiZcbiAgICAgICAgICAgIGNoYW5nZXMub3B0aW9ucyAmJlxuICAgICAgICAgICAgIWNoYW5nZXMub3B0aW9ucy5maXJzdENoYW5nZVxuICAgICAgICApIHtcbiAgICAgICAgICAgIGlmIChjaGFuZ2VzLm9wdGlvbnMucHJldmlvdXNWYWx1ZS50aGVtZSAhPT0gY2hhbmdlcy5vcHRpb25zLmN1cnJlbnRWYWx1ZS50aGVtZSkge1xuICAgICAgICAgICAgICAgIG1vbmFjby5lZGl0b3Iuc2V0VGhlbWUoY2hhbmdlcy5vcHRpb25zLmN1cnJlbnRWYWx1ZS50aGVtZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZWRpdG9yLnVwZGF0ZU9wdGlvbnMoY2hhbmdlcy5vcHRpb25zLmN1cnJlbnRWYWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXRNb25hY28oKSB7XG4gICAgICAgIGxldCBvcHRzOiBNb25hY29EaWZmRWRpdG9yQ29uc3RydWN0aW9uT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHJlYWRPbmx5OiB0cnVlLFxuICAgICAgICAgICAgYXV0b21hdGljTGF5b3V0OiB0cnVlLFxuICAgICAgICAgICAgdGhlbWU6ICd2YydcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucykge1xuICAgICAgICAgICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdHMsIHRoaXMub3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lZGl0b3IgPSBtb25hY28uZWRpdG9yLmNyZWF0ZURpZmZFZGl0b3IodGhpcy5jb250YWluZXIsIG9wdHMpO1xuXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsID0gbW9uYWNvLmVkaXRvci5jcmVhdGVNb2RlbCh0aGlzLm9yaWdpbmFsKTtcbiAgICAgICAgY29uc3QgbW9kaWZpZWQgPSBtb25hY28uZWRpdG9yLmNyZWF0ZU1vZGVsKHRoaXMubW9kaWZpZWQpO1xuXG4gICAgICAgIHRoaXMuZWRpdG9yLnNldE1vZGVsKHtcbiAgICAgICAgICAgIG9yaWdpbmFsLFxuICAgICAgICAgICAgbW9kaWZpZWRcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZWRpdG9yLmxheW91dCgpO1xuICAgICAgICB0aGlzLmluaXQuZW1pdCh0aGlzLmVkaXRvcik7XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIGlmICh0aGlzLmVkaXRvcikge1xuICAgICAgICAgICAgdGhpcy5lZGl0b3IuZGlzcG9zZSgpO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19